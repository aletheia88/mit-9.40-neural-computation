## local field potentials and convolution (lectrue 12)

### convolution
A impulse response function (IRF) for finding output $y(t)$ of a linear time-invariant system from some input $s(t)$. Let $h(t)$ be the response of a system to a unit impulse input, i.e., a delta stimulus, like a point source of light that is turned on and off quickly. This operation is defined as $$\int_{-\infty}^{\infty} h(t - \tau)\delta(\tau) d\tau = h(t)$$

Suppose the stimulus is given by $s(t)$, the response of the system $y(t)$ follows
$$y(t) = h(t) * s(t) \equiv \int_{-\infty}^{\infty} h(t - \tau) s(\tau) d\tau$$

In the discrete case, this is equivalent to
$$y(m) = \sum_{n=0}^{N-1} K(m - n) s(n) \Delta t$$
where $K$ is a filter. If $K$ has size $M$, then $0 \leq m - n < M$, so the output's size -- represented by $n$, same as the stimulus size -- follows $n \leq m < n + M$.

#### example: rectangular kernel
Let $s(t)$ be a sum of input pulses with random magnitudes generated by
$$s(t) = \sum_{n=0}^{99} a_n \delta(t - n)$$
where $a_n$ is drawn from a normal distribution.

See implementation in `scripts/local_field_potentials.py/rectangle_kernel`

### solving for post-synaptic current with convolution

Suppose the following kernel for convolution
$$K(t) = V_0 e^{-t/\tau'} \quad\quad \tau = 10 \ ms$$

and the following stimulus as input
$$ s(t) = \delta(t) + \delta(t - 5) \delta(t - 10)$$

The output $y(t)$ is
$$\begin{align*}
y(t) = \int_{t}^{t'} K(t - \tau) s(\tau) d\tau \\

=\int_{t}^{t'} K(t - \tau) \left[ \delta(\tau) + \delta(\tau - 5) \delta(\tau- 10) \right] d\tau \\

= K(0) + K(5) + K(10)

\end{align*}$$

Alternatively, since $$s(\tau) = \sum_{s} \delta(\tau - t_s),$$

the output can be written as
$$y(t) = \sum_n \int V_0 e^{-(t - \tau)/\tau'} \delta(\tau - nT) \ d\tau$$
where $T = 1/f$ is the period of spikes occurring.

If the first spike happens at $t=0$ (that is when $n=0$), the output is
$$y(t) = \int V_0 e^{-(t - \tau)/\tau'} \delta(\tau) \ d\tau = V_0 e^{-t/\tau'}$$

After the second spike, the convoluted response becomes
$$y(t) = \int V_0 e^{-(t - \tau)/\tau'} \{ \delta(\tau) + \delta(\tau - T)\} \ d\tau = V_0 e^{-t/\tau'} + V_0 e^{-(t - T)/\tau'} $$

In practice, if we have access to $s(t)$--stimulus typically that we can control--and the measurement of the output $V(t)$, then in principle, a single pulse should give us right away the kernel $K(t)$ since
$$V(t) = \int K(t - \tau) \delta(\tau - t_s) d\tau = K(t - t_s)$$


#### arbitrary stimulus

Suppose $s(t)$ is *any* stimulus defined by
$$s(t) = \int \delta(t - \tau)s(\tau) \ d\tau \tag{1}$$

Given an arbitrary $s(t)$, our goal is to find $V(t)$ such that $$\frac{dV}{dt} + \frac{1}{\tau} V = s(t)$$

To numerically solve for $V(t)$, we use the following form of $V(t + 1)$ for updates
$$dV_{t + 1} = s(t + 1) dt - \frac{dt}{\tau} V_{t + 1}$$

At time stamp $t+1$, we update the response voltage of a cell with
$$V_{t+1} = V_t + dV_{t + 1} = V_t + \left( s(t + 1) dt - \frac{dt}{\tau} V_{t+1} \right)$$

$$(1 + \frac{dt}{\tau}) V_{t + 1} = V_t + s(t + 1) dt$$

which makes
$$V_{t + 1} = \frac{V_t + s(t + 1) dt}{1 + \frac{dt}{\tau}} \tag{2}$$

See implementation of numerically solving Eq. $(2)$ in `scripts/local_field_potentials.py/general_stimulus`

For a single pulse, we have established that
$$\frac{d}{dt} K(t - \tau) + \frac{1}{\tau''} K(t - \tau) = \delta(t - \tau)$$

Substituting to Eq. $(1)$ makes $$s(t) = \int \left( \frac{d}{dt} K(t - \tau) + \frac{1}{\tau''} K(t - \tau) \right) s(\tau) d\tau$$

Because the integral (w.r.t to $\tau$) and the linear differentiator (w.r.t. $t$) is independent from each other, we can rewrite $s(t)$ into
$$s(t) = \left( \frac{d}{dt} + \frac{1}{\tau} \right) \int K(t - \tau) s(\tau) \ d\tau$$

Let's give a name to the integral on the RHS:
$$\int K(t - \tau) s(\tau) \ d\tau \equiv v(t)$$

The solution is $$s(t) = \frac{d v(t)}{dt} + \frac{1}{\tau} v(t)$$

Recall that we have solved for the single-pulse input case and we got
$$s(t) = \frac{dV}{dt} + \frac{1}{\tau} v$$
Therefore, $V(t) = v(t)$ or
$$V(t) = \int K(t - t')s(t') \ dt'$$

#### significance
Knowing the voltage response of a cell to a single spike, we can predict the voltage response of this cell to any other stimulus; this implies that the kernel $K(t)$ is an intrinsic property of the cell independent of the stimulus.

### edge detection in human vision system
